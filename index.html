<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡ßß‡ß® ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; min-height: 100vh; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 32px; margin-bottom: 10px; }
        .user-info { background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; margin-top: 15px; display: flex; justify-content: space-between; align-items: center; }
        .tabs { display: flex; background: #f8f9fa; border-bottom: 3px solid #667eea; overflow-x: auto; }
        .tab { flex: 1; min-width: 150px; padding: 20px; text-align: center; cursor: pointer; font-weight: bold; background: #f8f9fa; border: none; font-size: 16px; transition: all 0.3s; }
        .tab:hover { background: #e9ecef; }
        .tab.active { background: white; color: #667eea; border-bottom: 3px solid #667eea; margin-bottom: -3px; }
        .content { padding: 30px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .btn { background: #667eea; color: white; padding: 12px 25px; border: none; border-radius: 8px; font-size: 14px; cursor: pointer; font-weight: bold; transition: all 0.3s; margin: 5px; }
        .btn:hover { background: #764ba2; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #218838; }
        .btn-danger { background: #dc3545; }
        .btn-danger:hover { background: #c82333; }
        .btn-sm { padding: 8px 15px; font-size: 12px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { padding: 20px; border-radius: 12px; color: white; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .stat-card.green { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .stat-card.red { background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%); }
        .stat-card.blue { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .stat-card.purple { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333; }
        .stat-card h3 { font-size: 13px; margin-bottom: 8px; opacity: 0.9; }
        .stat-card .amount { font-size: 26px; font-weight: bold; }
        .form-card { background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); }
        .form-card h3 { color: #667eea; margin-bottom: 20px; font-size: 20px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-weight: bold; margin-bottom: 8px; color: #495057; font-size: 14px; }
        .form-group input, .form-group select, .form-group textarea { padding: 10px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 15px; transition: border-color 0.3s; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #667eea; }
        .form-group textarea { resize: vertical; min-height: 60px; }
        .transactions-table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 3px 10px rgba(0,0,0,0.1); }
        .transactions-table th { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; text-align: left; font-size: 14px; }
        .transactions-table td { padding: 12px 15px; border-bottom: 1px solid #dee2e6; font-size: 14px; }
        .transactions-table tr:hover { background: #f8f9fa; }
        .badge { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; display: inline-block; }
        .badge-income { background: #d4edda; color: #155724; }
        .badge-expense { background: #f8d7da; color: #721c24; }
        .partners-grid, .employees-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .partner-card, .employee-card { background: white; border: 2px solid #dee2e6; padding: 20px; border-radius: 10px; transition: all 0.3s; }
        .partner-card:hover, .employee-card:hover { border-color: #667eea; box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2); transform: translateY(-2px); }
        .partner-header { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 2px solid #dee2e6; }
        .partner-avatar { width: 50px; height: 50px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 20px; }
        .partner-info h3 { font-size: 16px; margin-bottom: 5px; color: #212529; }
        .partner-info p { font-size: 13px; color: #6c757d; }
        .partner-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .partner-stat { background: #f8f9fa; padding: 10px; border-radius: 6px; text-align: center; }
        .partner-stat label { font-size: 11px; color: #6c757d; display: block; margin-bottom: 5px; }
        .partner-stat .value { font-size: 16px; font-weight: bold; color: #212529; }
        .partner-stat.income .value { color: #28a745; }
        .partner-stat.expense .value { color: #dc3545; }
        .chart-container { background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); }
        .chart-container h3 { margin-bottom: 15px; color: #495057; font-size: 18px; }
        .empty-state { text-align: center; padding: 60px 20px; color: #6c757d; }
        .empty-state-icon { font-size: 64px; margin-bottom: 20px; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); }
        .modal-content { background: white; margin: 50px auto; padding: 30px; border-radius: 15px; max-width: 600px; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #dee2e6; }
        .close { font-size: 28px; font-weight: bold; color: #aaa; cursor: pointer; }
        .close:hover { color: #000; }
        .login-container { max-width: 400px; margin: 100px auto; background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .login-header { text-align: center; margin-bottom: 30px; }
        .login-header h2 { color: #667eea; margin-bottom: 10px; }
        .status-badge { padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: bold; margin-left: 8px; }
        .status-active { background: #d4edda; color: #155724; }
        .status-inactive { background: #f8d7da; color: #721c24; }
        .alert { padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-danger { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <div id="loginScreen">
        <div class="login-container">
            <div class="login-header">
                <h2>üîê ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
                <p style="color: #6c757d;">‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</p>
            </div>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ</label>
                    <input type="text" id="loginUsername" required>
                </div>
                <div class="form-group">
                    <label>‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%; margin-top: 20px;">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </form>
            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; font-size: 13px;">
                <strong>‡¶°‡ßá‡¶Æ‡ßã ‡¶≤‡¶ó‡¶á‡¶®:</strong><br>
                ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®: admin / admin123<br>
                ‡¶≠‡¶ø‡¶â‡¶Ø‡¶º‡¶æ‡¶∞: viewer / viewer123
            </div>
        </div>
    </div>

    <div class="container" id="mainApp" style="display: none;">
        <div class="header">
            <h1>üè¢ ‡ßß‡ß® ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</h1>
            <p>‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶∏‡¶Ç‡¶∏‡ßç‡¶ï‡¶∞‡¶£ - ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ ‡¶∏‡¶π</p>
            <div class="user-info">
                <span>üë§ <strong id="currentUserName"></strong> (<span id="currentUserRole"></span>)</span>
                <button class="btn btn-danger btn-sm" onclick="logout()">üö™ ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('dashboard')">üìä ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</button>
            <button class="tab" onclick="switchTab('transactions')">üí∞ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®</button>
            <button class="tab" onclick="switchTab('monthly')">üìÖ ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï</button>
            <button class="tab" onclick="switchTab('partners')">üë• ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞</button>
            <button class="tab" onclick="switchTab('employees')" id="employeesTab">üë®‚Äçüíº ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ</button>
            <button class="tab" onclick="switchTab('settings')" id="settingsTab">‚öôÔ∏è ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</button>
        </div>
        
        <div class="content">
            <div id="dashboard" class="tab-content active">
                <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <label style="font-weight: bold; margin-bottom: 10px; display: block;">‡¶Æ‡¶æ‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®:</label>
                    <select id="dashboardMonthSelect" onchange="updateDashboard()" style="width: 100%; padding: 12px; font-size: 16px; border: 2px solid #dee2e6; border-radius: 8px;">
                        <option value="all">‡¶∏‡¶ï‡¶≤ ‡¶Æ‡¶æ‡¶∏</option>
                    </select>
                </div>

                <div class="stats-grid">
                    <div class="stat-card green">
                        <h3>‡¶Æ‡ßã‡¶ü ‡¶ú‡¶Æ‡¶æ/‡¶Ü‡¶Ø‡¶º</h3>
                        <div class="amount">‡ß≥ <span id="totalIncome">0</span></div>
                    </div>
                    <div class="stat-card red">
                        <h3>‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º/‡¶ñ‡¶∞‡¶ö</h3>
                        <div class="amount">‡ß≥ <span id="totalExpense">0</span></div>
                    </div>
                    <div class="stat-card blue">
                        <h3>‡¶®‡¶ø‡¶ü ‡¶≤‡¶æ‡¶≠/‡¶≤‡ßã‡¶ï‡¶∏‡¶æ‡¶®</h3>
                        <div class="amount">‡ß≥ <span id="netProfit">0</span></div>
                    </div>
                    <div class="stat-card purple">
                        <h3>‡¶Æ‡ßã‡¶ü ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®</h3>
                        <div class="amount"><span id="totalTransactions">0</span> ‡¶ü‡¶ø</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h3>üìà ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®</h3>
                    <canvas id="dailyChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <h3>üìä ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶§‡ßÅ‡¶≤‡¶®‡¶æ</h3>
                    <canvas id="monthlyChart"></canvas>
                </div>
            </div>
            
            <div id="transactions" class="tab-content">
                <div class="form-card" id="txFormCard">
                    <h3>‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®</h3>
                    <form onsubmit="addTransaction(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ *</label>
                                <input type="date" id="txDate" required onchange="updateMonthFromDate()" max="">
                            </div>
                            <div class="form-group">
                                <label>‡¶Æ‡¶æ‡¶∏ *</label>
                                <select id="txMonth" required>
                                    <option value="">‡¶Æ‡¶æ‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>‡¶ß‡¶∞‡¶® *</label>
                                <select id="txType" required>
                                    <option value="">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                                    <option value="income">‡¶ú‡¶Æ‡¶æ/‡¶Ü‡¶Ø‡¶º</option>
                                    <option value="expense">‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º/‡¶ñ‡¶∞‡¶ö</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>‡¶ü‡¶æ‡¶ï‡¶æ *</label>
                                <input type="number" id="txAmount" placeholder="‡ß¶" required min="0" step="0.01">
                            </div>
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label>‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞</label>
                                <input type="text" id="txPartner" list="partnersList">
                                <datalist id="partnersList"></datalist>
                            </div>
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ *</label>
                                <textarea id="txDescription" required></textarea>
                            </div>
                        </div>
                        <div style="margin-top: 20px;">
                            <button type="submit" class="btn btn-success">üíæ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
                            <button type="reset" class="btn">üîÑ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü</button>
                        </div>
                    </form>
                </div>

                <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h4 style="margin-bottom: 15px;">üîç ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>‡¶Æ‡¶æ‡¶∏</label>
                            <select id="filterMonth" onchange="renderTransactions()">
                                <option value="all">‡¶∏‡¶ï‡¶≤ ‡¶Æ‡¶æ‡¶∏</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‡¶ß‡¶∞‡¶®</label>
                            <select id="filterType" onchange="renderTransactions()">
                                <option value="all">‡¶∏‡¶ï‡¶≤ ‡¶ß‡¶∞‡¶®</option>
                                <option value="income">‡¶ú‡¶Æ‡¶æ/‡¶Ü‡¶Ø‡¶º</option>
                                <option value="expense">‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º/‡¶ñ‡¶∞‡¶ö</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞</label>
                            <select id="filterPartner" onchange="renderTransactions()">
                                <option value="all">‡¶∏‡¶ï‡¶≤ ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div style="overflow-x: auto;">
                    <table class="transactions-table">
                        <thead>
                            <tr>
                                <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                                <th>‡¶Æ‡¶æ‡¶∏</th>
                                <th>‡¶ß‡¶∞‡¶®</th>
                                <th>‡¶ü‡¶æ‡¶ï‡¶æ</th>
                                <th>‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞</th>
                                <th>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th>
                                <th>‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ</th>
                            </tr>
                        </thead>
                        <tbody id="transactionsBody"></tbody>
                    </table>
                </div>
            </div>
            
            <div id="monthly" class="tab-content">
                <div style="text-align: right; margin-bottom: 20px;">
                    <button class="btn" onclick="exportMonthlyData()">üì• ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</button>
                </div>
                <div id="monthlySummary"></div>
            </div>
            
            <div id="partners" class="tab-content">
                <div style="text-align: right; margin-bottom: 20px;">
                    <button class="btn btn-success" onclick="showAddPartnerModal()" id="addPartnerBtn">‚ûï ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó</button>
                </div>
                <div class="partners-grid" id="partnersReport"></div>
            </div>

            <div id="employees" class="tab-content">
                <div style="text-align: right; margin-bottom: 20px;">
                    <button class="btn btn-success" onclick="showAddEmployeeModal()">‚ûï ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶Ø‡ßã‡¶ó</button>
                </div>
                <div class="employees-grid" id="employeesGrid"></div>
            </div>

            <div id="settings" class="tab-content">
                <div class="form-card">
                    <h3>üîê ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®</h3>
                    <div id="settingsAlert"></div>
                    <form onsubmit="changeAdminPassword(event)">
                        <div class="form-group">
                            <label>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° *</label>
                            <input type="password" id="currentPassword" required>
                        </div>
                        <div class="form-group">
                            <label>‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° *</label>
                            <input type="password" id="newPassword" required minlength="6">
                        </div>
                        <div class="form-group">
                            <label>‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶® *</label>
                            <input type="password" id="confirmPassword" required minlength="6">
                        </div>
                        <div style="margin-top: 20px;">
                            <button type="submit" class="btn btn-success">üíæ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
                        </div>
                    </form>
                </div>

                <div class="form-card">
                    <h3>üë§ ‡¶≠‡¶ø‡¶â‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®</h3>
                    <div id="viewerAlert"></div>
                    <form onsubmit="changeViewerPassword(event)">
                        <div class="form-group">
                            <label>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶≠‡¶ø‡¶â‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° *</label>
                            <input type="password" id="currentViewerPassword" required>
                        </div>
                        <div class="form-group">
                            <label>‡¶®‡¶§‡ßÅ‡¶® ‡¶≠‡¶ø‡¶â‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° *</label>
                            <input type="password" id="newViewerPassword" required minlength="6">
                        </div>
                        <div class="form-group">
                            <label>‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶® *</label>
                            <input type="password" id="confirmViewerPassword" required minlength="6">
                        </div>
                        <div style="margin-top: 20px;">
                            <button type="submit" class="btn btn-success">üíæ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
                        </div>
                    </form>
                </div>

                <div class="form-card">
                    <h3>‚ö†Ô∏è ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h3>
                    <p style="margin-bottom: 15px; color: #6c757d;">‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ: ‡¶è‡¶á ‡¶Ö‡¶™‡¶∂‡¶®‡¶ü‡¶ø ‡¶∏‡¶æ‡¶¨‡¶ß‡¶æ‡¶®‡ßá ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                    <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è ‡¶∏‡¶ï‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶®</button>
                </div>
            </div>
        </div>
    </div>

    <div id="partnerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="partnerModalTitle">‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞</h3>
                <span class="close" onclick="closePartnerModal()">&times;</span>
            </div>
            <form onsubmit="savePartner(event)">
                <input type="hidden" id="partnerEditId">
                <div class="form-group">
                    <label>‡¶®‡¶æ‡¶Æ *</label>
                    <input type="text" id="partnerName" required>
                </div>
                <div class="form-group">
                    <label>‡¶´‡ßã‡¶®</label>
                    <input type="text" id="partnerPhone">
                </div>
                <div class="form-group">
                    <label>‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ</label>
                    <select id="partnerStatus">
                        <option value="active">‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º</option>
                        <option value="inactive">‡¶¨‡¶®‡ßç‡¶ß</option>
                    </select>
                </div>
                <div style="margin-top: 20px;">
                    <button type="submit" class="btn btn-success">üíæ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
                    <button type="button" class="btn" onclick="closePartnerModal()">‚ùå ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                </div>
            </form>
        </div>
    </div>

    <div id="employeeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="employeeModalTitle">‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ</h3>
                <span class="close" onclick="closeEmployeeModal()">&times;</span>
            </div>
            <form onsubmit="saveEmployee(event)">
                <input type="hidden" id="employeeEditId">
                <div class="form-group">
                    <label>‡¶®‡¶æ‡¶Æ *</label>
                    <input type="text" id="employeeName" required>
                </div>
                <div class="form-group">
                    <label>‡¶™‡¶¶‡¶¨‡¶ø</label>
                    <input type="text" id="employeePosition">
                </div>
                <div class="form-group">
                    <label>‡¶´‡ßã‡¶®</label>
                    <input type="text" id="employeePhone">
                </div>
                <div class="form-group">
                    <label>‡¶¨‡ßá‡¶§‡¶®</label>
                    <input type="number" id="employeeSalary" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>‡¶Ø‡ßã‡¶ó‡¶¶‡¶æ‡¶®</label>
                    <input type="date" id="employeeJoinDate">
                </div>
                <div class="form-group">
                    <label>‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ</label>
                    <select id="employeeStatus">
                        <option value="active">‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º</option>
                        <option value="inactive">‡¶¨‡¶®‡ßç‡¶ß</option>
                    </select>
                </div>
                <div style="margin-top: 20px;">
                    <button type="submit" class="btn btn-success">üíæ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
                    <button type="button" class="btn" onclick="closeEmployeeModal()">‚ùå ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let transactions = [];
        let partners = [
            { id: 1, name: '‡¶Ü‡¶¨‡ßÅ‡¶≤ ‡¶π‡ßã‡¶∏‡ßá‡¶®', phone: '‡ß¶‡ßß‡ß≠‡ßß‡ßß-‡ßß‡ß®‡ß©‡ß™‡ß´‡ß¨', status: 'active' },
            { id: 2, name: '‡¶∞‡¶π‡¶ø‡¶Æ ‡¶â‡¶¶‡ßç‡¶¶‡¶ø‡¶®', phone: '‡ß¶‡ßß‡ßÆ‡ß®‡ß®-‡ß®‡ß©‡ß™‡ß´‡ß¨‡ß≠', status: 'active' },
            { id: 3, name: '‡¶ï‡¶∞‡¶ø‡¶Æ ‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ', phone: '‡ß¶‡ßß‡ßØ‡ß©‡ß©-‡ß©‡ß™‡ß´‡ß¨‡ß≠‡ßÆ', status: 'active' },
            { id: 4, name: '‡¶∏‡¶æ‡¶≤‡¶æ‡¶Æ ‡¶ñ‡¶æ‡¶®', phone: '‡ß¶‡ßß‡ß≠‡ß™‡ß™-‡ß™‡ß´‡ß¨‡ß≠‡ßÆ‡ßØ', status: 'active' },
            { id: 5, name: '‡¶ú‡¶æ‡¶π‡¶ø‡¶¶ ‡¶Ü‡¶≤‡ßÄ', phone: '‡ß¶‡ßß‡ßÆ‡ß´‡ß´-‡ß´‡ß¨‡ß≠‡ßÆ‡ßØ‡ß¶', status: 'active' },
            { id: 6, name: '‡¶®‡¶æ‡¶∏‡¶ø‡¶∞ ‡¶â‡¶≤‡ßç‡¶≤‡¶æ‡¶π', phone: '‡ß¶‡ßß‡ßØ‡ß¨‡ß¨-‡ß¨‡ß≠‡ßÆ‡ßØ‡ß¶‡ßß', status: 'active' },
            { id: 7, name: '‡¶´‡¶æ‡¶∞‡ßÅ‡¶ï ‡¶Ü‡¶π‡¶Æ‡ßá‡¶¶', phone: '‡ß¶‡ßß‡ß≠‡ß≠‡ß≠-‡ß≠‡ßÆ‡ßØ‡ß¶‡ßß‡ß®', status: 'active' },
            { id: 8, name: '‡¶∂‡¶´‡¶ø‡¶ï ‡¶∞‡¶π‡¶Æ‡¶æ‡¶®', phone: '‡ß¶‡ßß‡ßÆ‡ßÆ‡ßÆ-‡ßÆ‡ßØ‡ß¶‡ßß‡ß®‡ß©', status: 'active' },
            { id: 9, name: '‡¶Æ‡¶æ‡¶π‡¶Æ‡ßÅ‡¶¶ ‡¶π‡¶æ‡¶∏‡¶æ‡¶®', phone: '‡ß¶‡ßß‡ßØ‡ßØ‡ßØ-‡ßØ‡ß¶‡ßß‡ß®‡ß©‡ß™', status: 'active' },
            { id: 10, name: '‡¶Ü‡¶®‡ßã‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶π‡ßá‡¶¨', phone: '‡ß¶‡ßß‡ß≠‡ß¶‡ß¶-‡ß¶‡ßß‡ß®‡ß©‡ß™‡ß´', status: 'active' },
            { id: 11, name: '‡¶¨‡¶æ‡¶¨‡ßÅ‡¶≤ ‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ', phone: '‡ß¶‡ßß‡ßÆ‡ßß‡ßß-‡ßß‡ß®‡ß©‡ß™‡ß´‡ß¨', status: 'active' },
            { id: 12, name: '‡¶ï‡¶æ‡¶Æ‡¶æ‡¶≤ ‡¶™‡¶æ‡¶∂‡¶æ', phone: '‡ß¶‡ßß‡ßØ‡ß®‡ß®-‡ß®‡ß©‡ß™‡ß´‡ß¨‡ß≠', status: 'active' }
        ];
        let employees = [];
        let currentUser = null;
        let dailyChart = null;
        let monthlyChart = null;

        const monthNames = ['‡¶ú‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø', '‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø', '‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö', '‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤', '‡¶Æ‡ßá', '‡¶ú‡ßÅ‡¶®', '‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á', '‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü', '‡¶∏‡ßá‡¶™‡ßç‡¶ü‡ßá‡¶Æ‡ßç‡¶¨‡¶∞', '‡¶Ö‡¶ï‡ßç‡¶ü‡ßã‡¶¨‡¶∞', '‡¶®‡¶≠‡ßá‡¶Æ‡ßç‡¶¨‡¶∞', '‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞'];
        
        function getAvailableMonths() {
            const today = new Date();
            const currentYear = today.getFullYear();
            const currentMonth = today.getMonth();
            const months = [];
            
            // Generate months from 3 years ago to current month
            for (let year = currentYear - 3; year <= currentYear; year++) {
                const endMonth = (year === currentYear) ? currentMonth : 11;
                for (let month = 0; month <= endMonth; month++) {
                    const yearBn = year.toString().replace(/0/g, '‡ß¶').replace(/1/g, '‡ßß').replace(/2/g, '‡ß®').replace(/3/g, '‡ß©').replace(/4/g, '‡ß™').replace(/5/g, '‡ß´').replace(/6/g, '‡ß¨').replace(/7/g, '‡ß≠').replace(/8/g, '‡ßÆ').replace(/9/g, '‡ßØ');
                    months.push({
                        value: `${monthNames[month]} ${yearBn}`,
                        label: `${monthNames[month]} ${yearBn}`
                    });
                }
            }
            
            return months;
        }

        function getUsers() {
            const saved = localStorage.getItem('appUsers');
            if (saved) {
                return JSON.parse(saved);
            }
            return {
                admin: { password: 'admin123', role: 'admin', name: '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®' },
                viewer: { password: 'viewer123', role: 'viewer', name: '‡¶≠‡¶ø‡¶â‡¶Ø‡¶º‡¶æ‡¶∞' }
            };
        }

        function saveUsers(users) {
            localStorage.setItem('appUsers', JSON.stringify(users));
        }

        function init() {
            const saved = localStorage.getItem('currentUser');
            if (saved) {
                currentUser = JSON.parse(saved);
                showMainApp();
            } else {
                document.getElementById('loginScreen').style.display = 'block';
            }
        }

        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const users = getUsers();

            if (users[username] && users[username].password === password) {
                currentUser = { username, role: users[username].role, name: users[username].name };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showMainApp();
            } else {
                alert('‚ùå ‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°!');
            }
        }

        function logout() {
            if (confirm('‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                localStorage.removeItem('currentUser');
                currentUser = null;
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'block';
            }
        }

        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('currentUserName').textContent = currentUser.name;
            document.getElementById('currentUserRole').textContent = currentUser.role === 'admin' ? '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®' : '‡¶≠‡¶ø‡¶â‡¶Ø‡¶º‡¶æ‡¶∞';
            
            applyPermissions();
            loadData();
            populateMonthDropdowns();
            updatePartnersDatalist();
            updateFilters();
            setDefaultDate();
            renderTransactions();
            updateDashboard();
            updateMonthlySummary();
            updatePartnersReport();
            updateEmployeesGrid();
        }

        function applyPermissions() {
            const isViewer = currentUser.role === 'viewer';
            if (isViewer) {
                const hide = ['txFormCard', 'addPartnerBtn', 'employeesTab', 'settingsTab'];
                hide.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.style.display = 'none';
                });
            }
        }

        function loadData() {
            const t = localStorage.getItem('businessTransactions');
            if (t) transactions = JSON.parse(t);
            const p = localStorage.getItem('businessPartners');
            if (p) partners = JSON.parse(p);
            const e = localStorage.getItem('businessEmployees');
            if (e) employees = JSON.parse(e);
        }

        function saveData() {
            localStorage.setItem('businessTransactions', JSON.stringify(transactions));
            localStorage.setItem('businessPartners', JSON.stringify(partners));
            localStorage.setItem('businessEmployees', JSON.stringify(employees));
        }

        function populateMonthDropdowns() {
            const months = getAvailableMonths();
            let options = '<option value="">‡¶Æ‡¶æ‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>';
            months.forEach(month => {
                options += `<option value="${month.value}">${month.label}</option>`;
            });
            document.getElementById('txMonth').innerHTML = options;
        }

        function setDefaultDate() {
            const today = new Date().toISOString().split('T')[0];
            const dateInput = document.getElementById('txDate');
            dateInput.value = today;
            dateInput.max = today; // Set max date to today
            updateMonthFromDate();
        }

        function updateMonthFromDate() {
            const dateInput = document.getElementById('txDate').value;
            if (!dateInput) return;
            
            const selectedDate = new Date(dateInput);
            const monthIndex = selectedDate.getMonth();
            const year = selectedDate.getFullYear();
            
            // Convert year to Bengali
            const yearBn = year.toString().replace(/0/g, '‡ß¶').replace(/1/g, '‡ßß').replace(/2/g, '‡ß®').replace(/3/g, '‡ß©').replace(/4/g, '‡ß™').replace(/5/g, '‡ß´').replace(/6/g, '‡ß¨').replace(/7/g, '‡ß≠').replace(/8/g, '‡ßÆ').replace(/9/g, '‡ßØ');
            
            const selectedMonth = `${monthNames[monthIndex]} ${yearBn}`;
            const monthSelect = document.getElementById('txMonth');
            
            // Set the selected value
            const options = monthSelect.querySelectorAll('option');
            for (let i = 0; i < options.length; i++) {
                if (options[i].value === selectedMonth) {
                    monthSelect.selectedIndex = i;
                    break;
                }
            }
        }

        function updatePartnersDatalist() {
            const datalist = document.getElementById('partnersList');
            const active = partners.filter(p => p.status === 'active');
            datalist.innerHTML = active.map(p => `<option value="${p.name}">`).join('');
        }

        function updateFilters() {
            const months = [...new Set(transactions.map(t => t.month))];
            const selects = ['filterMonth', 'dashboardMonthSelect'];
            selects.forEach(id => {
                const sel = document.getElementById(id);
                const curr = sel.value;
                sel.innerHTML = '<option value="all">‡¶∏‡¶ï‡¶≤ ‡¶Æ‡¶æ‡¶∏</option>' + months.map(m => `<option value="${m}">${m}</option>`).join('');
                if (curr && months.includes(curr)) sel.value = curr;
            });

            const partnerNames = [...new Set(transactions.filter(t => t.partner).map(t => t.partner))];
            const pSel = document.getElementById('filterPartner');
            pSel.innerHTML = '<option value="all">‡¶∏‡¶ï‡¶≤ ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞</option>' + partnerNames.map(p => `<option value="${p}">${p}</option>`).join('');
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tab).classList.add('active');
            
            if (tab === 'dashboard') updateDashboard();
            else if (tab === 'transactions') renderTransactions();
            else if (tab === 'monthly') updateMonthlySummary();
            else if (tab === 'partners') updatePartnersReport();
            else if (tab === 'employees') updateEmployeesGrid();
        }

        function addTransaction(e) {
            e.preventDefault();
            const tx = {
                id: Date.now(),
                date: document.getElementById('txDate').value,
                month: document.getElementById('txMonth').value,
                type: document.getElementById('txType').value,
                amount: parseFloat(document.getElementById('txAmount').value),
                partner: document.getElementById('txPartner').value.trim(),
                description: document.getElementById('txDescription').value.trim()
            };
            transactions.push(tx);
            transactions.sort((a, b) => new Date(b.date) - new Date(a.date));
            saveData();
            updateFilters();
            renderTransactions();
            updateDashboard();
            updateMonthlySummary();
            updatePartnersReport();
            e.target.reset();
            setDefaultDate();
            alert('‚úÖ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶Ø‡ßã‡¶ó ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
        }

        function deleteTransaction(id) {
            if (confirm('‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                transactions = transactions.filter(t => t.id !== id);
                saveData();
                updateFilters();
                renderTransactions();
                updateDashboard();
                updateMonthlySummary();
                updatePartnersReport();
            }
        }

        function renderTransactions() {
            const tbody = document.getElementById('transactionsBody');
            let filtered = transactions;
            
            const mf = document.getElementById('filterMonth').value;
            if (mf !== 'all') filtered = filtered.filter(t => t.month === mf);
            
            const tf = document.getElementById('filterType').value;
            if (tf !== 'all') filtered = filtered.filter(t => t.type === tf);
            
            const pf = document.getElementById('filterPartner').value;
            if (pf !== 'all') filtered = filtered.filter(t => t.partner === pf);

            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px;">‡¶ï‡ßã‡¶® ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶®‡ßá‡¶á</td></tr>';
                return;
            }

            const isViewer = currentUser && currentUser.role === 'viewer';
            tbody.innerHTML = filtered.map(t => `
                <tr>
                    <td>${new Date(t.date).toLocaleDateString('bn-BD')}</td>
                    <td>${t.month}</td>
                    <td><span class="badge badge-${t.type === 'income' ? 'income' : 'expense'}">${t.type === 'income' ? '‡¶ú‡¶Æ‡¶æ' : '‡¶ñ‡¶∞‡¶ö'}</span></td>
                    <td style="font-weight: bold; color: ${t.type === 'income' ? '#28a745' : '#dc3545'}">‡ß≥ ${t.amount.toLocaleString('bn-BD')}</td>
                    <td>${t.partner || '-'}</td>
                    <td>${t.description}</td>
                    <td>${!isViewer ? `<button class="btn btn-danger btn-sm" onclick="deleteTransaction(${t.id})">üóëÔ∏è</button>` : '-'}</td>
                </tr>
            `).join('');
        }

        function updateDashboard() {
            const mf = document.getElementById('dashboardMonthSelect').value;
            let filtered = mf !== 'all' ? transactions.filter(t => t.month === mf) : transactions;

            const income = filtered.filter(t => t.type === 'income').reduce((s, t) => s + t.amount, 0);
            const expense = filtered.filter(t => t.type === 'expense').reduce((s, t) => s + t.amount, 0);
            
            document.getElementById('totalIncome').textContent = income.toLocaleString('bn-BD');
            document.getElementById('totalExpense').textContent = expense.toLocaleString('bn-BD');
            document.getElementById('netProfit').textContent = (income - expense).toLocaleString('bn-BD');
            document.getElementById('totalTransactions').textContent = filtered.length;

            updateDailyChart(filtered);
            updateMonthlyChart();
        }

        function updateDailyChart(filtered) {
            const ctx = document.getElementById('dailyChart');
            if (dailyChart) dailyChart.destroy();

            if (filtered.length === 0) {
                ctx.parentElement.innerHTML = '<p style="text-align: center; padding: 40px;">‡¶ï‡ßã‡¶® ‡¶°‡¶æ‡¶ü‡¶æ ‡¶®‡ßá‡¶á</p><canvas id="dailyChart"></canvas>';
                return;
            }

            const groups = {};
            filtered.forEach(t => {
                if (!groups[t.date]) groups[t.date] = { income: 0, expense: 0 };
                groups[t.date][t.type] += t.amount;
            });

            const dates = Object.keys(groups).sort();
            const data = dates.map(d => ({ date: new Date(d).toLocaleDateString('bn-BD'), income: groups[d].income, expense: groups[d].expense }));

            dailyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.date),
                    datasets: [
                        { label: '‡¶ú‡¶Æ‡¶æ', data: data.map(d => d.income), borderColor: '#28a745', backgroundColor: 'rgba(40, 167, 69, 0.1)', tension: 0.4 },
                        { label: '‡¶ñ‡¶∞‡¶ö', data: data.map(d => d.expense), borderColor: '#dc3545', backgroundColor: 'rgba(220, 53, 69, 0.1)', tension: 0.4 }
                    ]
                },
                options: { responsive: true, plugins: { legend: { display: true, position: 'top' } } }
            });
        }

        function updateMonthlyChart() {
            const ctx = document.getElementById('monthlyChart');
            if (monthlyChart) monthlyChart.destroy();

            const groups = {};
            transactions.forEach(t => {
                if (!groups[t.month]) groups[t.month] = { income: 0, expense: 0 };
                groups[t.month][t.type] += t.amount;
            });

            const months = Object.keys(groups);
            const data = months.map(m => ({ month: m, income: groups[m].income, expense: groups[m].expense, profit: groups[m].income - groups[m].expense }));

            monthlyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d.month),
                    datasets: [
                        { label: '‡¶ú‡¶Æ‡¶æ', data: data.map(d => d.income), backgroundColor: 'rgba(40, 167, 69, 0.8)' },
                        { label: '‡¶ñ‡¶∞‡¶ö', data: data.map(d => d.expense), backgroundColor: 'rgba(220, 53, 69, 0.8)' },
                        { label: '‡¶≤‡¶æ‡¶≠', data: data.map(d => d.profit), backgroundColor: 'rgba(79, 172, 254, 0.8)' }
                    ]
                },
                options: { responsive: true, plugins: { legend: { display: true, position: 'top' } } }
            });
        }

        function updateMonthlySummary() {
            const container = document.getElementById('monthlySummary');
            const groups = {};
            transactions.forEach(t => {
                if (!groups[t.month]) groups[t.month] = { income: 0, expense: 0, transactions: [] };
                groups[t.month][t.type] += t.amount;
                groups[t.month].transactions.push(t);
            });

            if (Object.keys(groups).length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìÖ</div><h3>‡¶ï‡ßã‡¶® ‡¶°‡¶æ‡¶ü‡¶æ ‡¶®‡ßá‡¶á</h3></div>';
                return;
            }

            container.innerHTML = Object.keys(groups).map(m => {
                const d = groups[m];
                const profit = d.income - d.expense;
                return `
                    <div class="form-card">
                        <h3>üìÖ ${m}</h3>
                        <div class="stats-grid">
                            <div class="stat-card green"><h3>‡¶ú‡¶Æ‡¶æ</h3><div class="amount">‡ß≥ ${d.income.toLocaleString('bn-BD')}</div></div>
                            <div class="stat-card red"><h3>‡¶ñ‡¶∞‡¶ö</h3><div class="amount">‡ß≥ ${d.expense.toLocaleString('bn-BD')}</div></div>
                            <div class="stat-card ${profit >= 0 ? 'blue' : 'red'}"><h3>‡¶≤‡¶æ‡¶≠/‡¶≤‡ßã‡¶ï‡¶∏‡¶æ‡¶®</h3><div class="amount">‡ß≥ ${profit.toLocaleString('bn-BD')}</div></div>
                            <div class="stat-card purple"><h3>‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®</h3><div class="amount">${d.transactions.length} ‡¶ü‡¶ø</div></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updatePartnersReport() {
            const container = document.getElementById('partnersReport');
            const data = {};
            
            partners.forEach(p => {
                data[p.name] = { ...p, income: 0, expense: 0, transactions: [] };
            });

            transactions.forEach(t => {
                if (t.partner) {
                    if (!data[t.partner]) data[t.partner] = { name: t.partner, phone: '', status: 'active', income: 0, expense: 0, transactions: [] };
                    data[t.partner][t.type] += t.amount;
                    data[t.partner].transactions.push(t);
                }
            });

            const active = Object.values(data).filter(p => p.transactions.length > 0 || p.phone);
            if (active.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üë•</div><h3>‡¶ï‡ßã‡¶® ‡¶°‡¶æ‡¶ü‡¶æ ‡¶®‡ßá‡¶á</h3></div>';
                return;
            }

            const isViewer = currentUser && currentUser.role === 'viewer';
            container.innerHTML = active.map((p, i) => {
                const net = p.income - p.expense;
                const badge = p.status === 'active' ? '<span class="status-badge status-active">‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º</span>' : '<span class="status-badge status-inactive">‡¶¨‡¶®‡ßç‡¶ß</span>';
                return `
                    <div class="partner-card">
                        <div class="partner-header">
                            <div class="partner-avatar">${p.id || i + 1}</div>
                            <div class="partner-info" style="flex: 1;">
                                <h3>${p.name} ${badge}</h3>
                                ${p.phone ? `<p>${p.phone}</p>` : ''}
                            </div>
                        </div>
                        <div class="partner-stats">
                            <div class="partner-stat income"><label>‡¶ú‡¶Æ‡¶æ</label><div class="value">‡ß≥ ${p.income.toLocaleString('bn-BD')}</div></div>
                            <div class="partner-stat expense"><label>‡¶ñ‡¶∞‡¶ö</label><div class="value">‡ß≥ ${p.expense.toLocaleString('bn-BD')}</div></div>
                            <div class="partner-stat"><label>‡¶®‡¶ø‡¶ü</label><div class="value" style="color: ${net >= 0 ? '#28a745' : '#dc3545'}">‡ß≥ ${net.toLocaleString('bn-BD')}</div></div>
                            <div class="partner-stat"><label>‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®</label><div class="value">${p.transactions.length} ‡¶ü‡¶ø</div></div>
                        </div>
                        ${!isViewer && p.id ? `
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-sm" onclick="editPartner(${p.id})">‚úèÔ∏è ‡¶è‡¶°‡¶ø‡¶ü</button>
                            <button class="btn btn-sm ${p.status === 'active' ? 'btn-danger' : 'btn-success'}" onclick="togglePartnerStatus(${p.id})">
                                ${p.status === 'active' ? 'üîí ‡¶¨‡¶®‡ßç‡¶ß' : 'üîì ‡¶ö‡¶æ‡¶≤‡ßÅ'}
                            </button>
                        </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function showAddPartnerModal() {
            document.getElementById('partnerModalTitle').textContent = '‡¶®‡¶§‡ßÅ‡¶® ‡¶Ü‡¶Ç‡¶∂‡ßÄ‡¶¶‡¶æ‡¶∞';
            document.getElementById('partnerEditId').value = '';
            document.getElementById('partnerName').value = '';
            document.getElementById('partnerPhone').value = '';
            document.getElementById('partnerStatus').value = 'active';
            document.getElementById('partnerModal').style.display = 'block';
        }

        function editPartner(id) {
            const p = partners.find(x => x.id === id);
            if (!p) return;
            document.getElementById('partnerModalTitle').textContent = '‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®';
            document.getElementById('partnerEditId').value = p.id;
            document.getElementById('partnerName').value = p.name;
            document.getElementById('partnerPhone').value = p.phone || '';
            document.getElementById('partnerStatus').value = p.status || 'active';
            document.getElementById('partnerModal').style.display = 'block';
        }

        function closePartnerModal() {
            document.getElementById('partnerModal').style.display = 'none';
        }

        function savePartner(e) {
            e.preventDefault();
            const id = document.getElementById('partnerEditId').value;
            const name = document.getElementById('partnerName').value.trim();
            const phone = document.getElementById('partnerPhone').value.trim();
            const status = document.getElementById('partnerStatus').value;

            if (id) {
                const p = partners.find(x => x.id === parseInt(id));
                if (p) { p.name = name; p.phone = phone; p.status = status; }
            } else {
                const newId = partners.length > 0 ? Math.max(...partners.map(p => p.id)) + 1 : 1;
                partners.push({ id: newId, name, phone, status });
            }

            saveData();
            updatePartnersDatalist();
            updatePartnersReport();
            closePartnerModal();
            alert('‚úÖ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§!');
        }

        function togglePartnerStatus(id) {
            const p = partners.find(x => x.id === id);
            if (!p) return;
            const newStatus = p.status === 'active' ? 'inactive' : 'active';
            if (confirm(newStatus === 'inactive' ? '‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?' : '‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?')) {
                p.status = newStatus;
                saveData();
                updatePartnersDatalist();
                updatePartnersReport();
            }
        }

        function showAddEmployeeModal() {
            document.getElementById('employeeModalTitle').textContent = '‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ';
            document.getElementById('employeeEditId').value = '';
            document.getElementById('employeeName').value = '';
            document.getElementById('employeePosition').value = '';
            document.getElementById('employeePhone').value = '';
            document.getElementById('employeeSalary').value = '';
            document.getElementById('employeeJoinDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('employeeStatus').value = 'active';
            document.getElementById('employeeModal').style.display = 'block';
        }

        function editEmployee(id) {
            const e = employees.find(x => x.id === id);
            if (!e) return;
            document.getElementById('employeeModalTitle').textContent = '‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®';
            document.getElementById('employeeEditId').value = e.id;
            document.getElementById('employeeName').value = e.name;
            document.getElementById('employeePosition').value = e.position || '';
            document.getElementById('employeePhone').value = e.phone || '';
            document.getElementById('employeeSalary').value = e.salary || '';
            document.getElementById('employeeJoinDate').value = e.joinDate || '';
            document.getElementById('employeeStatus').value = e.status || 'active';
            document.getElementById('employeeModal').style.display = 'block';
        }

        function closeEmployeeModal() {
            document.getElementById('employeeModal').style.display = 'none';
        }

        function saveEmployee(e) {
            e.preventDefault();
            const id = document.getElementById('employeeEditId').value;
            const name = document.getElementById('employeeName').value.trim();
            const position = document.getElementById('employeePosition').value.trim();
            const phone = document.getElementById('employeePhone').value.trim();
            const salary = parseFloat(document.getElementById('employeeSalary').value) || 0;
            const joinDate = document.getElementById('employeeJoinDate').value;
            const status = document.getElementById('employeeStatus').value;

            if (id) {
                const emp = employees.find(x => x.id === parseInt(id));
                if (emp) { emp.name = name; emp.position = position; emp.phone = phone; emp.salary = salary; emp.joinDate = joinDate; emp.status = status; }
            } else {
                const newId = employees.length > 0 ? Math.max(...employees.map(e => e.id)) + 1 : 1;
                employees.push({ id: newId, name, position, phone, salary, joinDate, status });
            }

            saveData();
            updateEmployeesGrid();
            closeEmployeeModal();
            alert('‚úÖ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§!');
        }

        function deleteEmployee(id) {
            if (confirm('‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡¶®?')) {
                employees = employees.filter(e => e.id !== id);
                saveData();
                updateEmployeesGrid();
            }
        }

        function updateEmployeesGrid() {
            const container = document.getElementById('employeesGrid');
            if (employees.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üë®‚Äçüíº</div><h3>‡¶ï‡ßã‡¶® ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ö‡¶æ‡¶∞‡ßÄ ‡¶®‡ßá‡¶á</h3></div>';
                return;
            }

            container.innerHTML = employees.map(e => {
                const badge = e.status === 'active' ? '<span class="status-badge status-active">‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º</span>' : '<span class="status-badge status-inactive">‡¶¨‡¶®‡ßç‡¶ß</span>';
                return `
                    <div class="employee-card">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                            <div>
                                <h3>${e.name} ${badge}</h3>
                                ${e.position ? `<p style="color: #6c757d; font-size: 13px;">${e.position}</p>` : ''}
                            </div>
                        </div>
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                            ${e.phone ? `<p><strong>üì±:</strong> ${e.phone}</p>` : ''}
                            ${e.salary ? `<p><strong>üí∞:</strong> ‡ß≥ ${e.salary.toLocaleString('bn-BD')}</p>` : ''}
                            ${e.joinDate ? `<p><strong>üìÖ:</strong> ${new Date(e.joinDate).toLocaleDateString('bn-BD')}</p>` : ''}
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-sm" onclick="editEmployee(${e.id})">‚úèÔ∏è ‡¶è‡¶°‡¶ø‡¶ü</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteEmployee(${e.id})">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function changeAdminPassword(e) {
            e.preventDefault();
            const users = getUsers();
            const current = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;
            const alertDiv = document.getElementById('settingsAlert');

            if (users.admin.password !== current) {
                alertDiv.innerHTML = '<div class="alert alert-danger">‚ùå ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤!</div>';
                return;
            }

            if (newPass !== confirm) {
                alertDiv.innerHTML = '<div class="alert alert-danger">‚ùå ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡¶ø‡¶≤‡¶õ‡ßá ‡¶®‡¶æ!</div>';
                return;
            }

            if (newPass.length < 6) {
                alertDiv.innerHTML = '<div class="alert alert-danger">‚ùå ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá!</div>';
                return;
            }

            users.admin.password = newPass;
            saveUsers(users);
            alertDiv.innerHTML = '<div class="alert alert-success">‚úÖ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!</div>';
            e.target.reset();
        }

        function changeViewerPassword(e) {
            e.preventDefault();
            const users = getUsers();
            const current = document.getElementById('currentViewerPassword').value;
            const newPass = document.getElementById('newViewerPassword').value;
            const confirm = document.getElementById('confirmViewerPassword').value;
            const alertDiv = document.getElementById('viewerAlert');

            if (users.viewer.password !== current) {
                alertDiv.innerHTML = '<div class="alert alert-danger">‚ùå ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤!</div>';
                return;
            }

            if (newPass !== confirm) {
                alertDiv.innerHTML = '<div class="alert alert-danger">‚ùå ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡¶ø‡¶≤‡¶õ‡ßá ‡¶®‡¶æ!</div>';
                return;
            }

            if (newPass.length < 6) {
                alertDiv.innerHTML = '<div class="alert alert-danger">‚ùå ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá!</div>';
                return;
            }

            users.viewer.password = newPass;
            saveUsers(users);
            alertDiv.innerHTML = '<div class="alert alert-success">‚úÖ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!</div>';
            e.target.reset();
        }

        function clearAllData() {
            if (confirm('‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ! ‡¶è‡¶ü‡¶ø ‡¶∏‡¶ï‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡•§ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§?')) {
                if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶∏‡¶§‡ßç‡¶Ø‡¶ø‡¶á ‡¶∏‡¶ï‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                    localStorage.removeItem('businessTransactions');
                    localStorage.removeItem('businessPartners');
                    localStorage.removeItem('businessEmployees');
                    alert('‚úÖ ‡¶∏‡¶ï‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
                    location.reload();
                }
            }
        }

        function exportMonthlyData() {
            const groups = {};
            transactions.forEach(t => {
                if (!groups[t.month]) groups[t.month] = { income: 0, expense: 0 };
                groups[t.month][t.type] += t.amount;
            });

            let text = '‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü\n' + '='.repeat(50) + '\n\n';
            Object.keys(groups).forEach(m => {
                const d = groups[m];
                const p = d.income - d.expense;
                text += `${m}\n‡¶ú‡¶Æ‡¶æ: ‡ß≥ ${d.income.toLocaleString('bn-BD')}\n‡¶ñ‡¶∞‡¶ö: ‡ß≥ ${d.expense.toLocaleString('bn-BD')}\n‡¶≤‡¶æ‡¶≠: ‡ß≥ ${p.toLocaleString('bn-BD')}\n${'-'.repeat(50)}\n\n`;
            });

            const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = '‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï-‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü.txt';
            a.click();
        }

        window.onclick = function(event) {
            if (event.target.className === 'modal') {
                event.target.style.display = 'none';
            }
        }

        init();
    </script>
</body>
</html>